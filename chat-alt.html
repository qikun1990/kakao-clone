<!-- Seventh page of the Kokoa Clone  -->
<!-- 09.png of the screenshots -->
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Linking with css file and a short cut is link:css -->
  <link rel="stylesheet" href="css/styles.css" />
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat with Sophia - to Kokoa Clone</title>
  <style>
    .chat-image {
      display: block;
      max-width: 280px;
      width: 100%;
      height: auto;
      margin-top: 1px;
      margin-bottom: 5px;
      /* å¯é€‰ï¼šæ·»åŠ ä¸Šè¾¹è·ä»¥å¢åŠ å›¾ç‰‡ä¸æ–‡å­—ä¹‹é—´çš„é—´è· */
      border-radius: 10px;
      filter: blur(5px);
      cursor: pointer; /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºä¸ºå¯ç‚¹å‡» */
    }
    .message__bubble {
      margin-right: 5px; /* Add margin to the right of the message bubble */
    }
    .message__time {
      margin-left: 5px; /* Add margin to the left of the message time */
    }
    .message__info {
      margin-bottom: 2px; /* Reduce margin to the bottom of each message info */
    }
    #chat-container {
      overflow-y: auto;
      padding-bottom: 60px; /* Ensure space for the reply form */
    }

    /* æ¨¡æ€å¼¹çª—çš„æ ·å¼ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5); /* åŠé€æ˜èƒŒæ™¯ */
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000; /* ç¡®ä¿å¼¹çª—åœ¨æœ€ä¸Šå±‚ */
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }
  </style>
</head>

<body id="chat-screen">
  <header class="alt-header">
    <div class="alt-header__column">
      <a href="chats.html"><i class="fas fa-angle-left fa-2x"></i></a>
    </div>
    <div class="alt-header__column">
      <div class="alt-header__title">Sophia</div>
    </div>
    <div class="alt-header__column">
      <span><i class="fas fa-search fa-lg"></i></span>
      <span><i class="fas fa-bars fa-lg alt-header__column-icon-last"></i></span>
    </div>
  </header>

  <main class="main-screen main-chat" id="chat-container">
    <div class="chat__timestamp">Friday, August 20, 2021</div>
    <!-- The chat messages will be added here -->
  </main>

  <form class="reply">
    <div class="reply__column">
      <i class="far fa-plus-square fa-2x"></i>
    </div>
    <div class="reply__column">
      <input type="text" placeholder="Write a message..." />
      <i class="far fa-smile-wink fa-2x"></i>
      <button><i class="fas fa-arrow-up fa-lg"></i></button>
    </div>
  </form>

  <!-- æ·»åŠ æ¨¡æ€å¼¹çª—çš„ HTML -->
  <div id="modal-overlay" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <p>è¯·å®ŒæˆéªŒè¯ä»¥æŸ¥çœ‹å›¾ç‰‡ã€‚</p>
      <button id="verify-button">éªŒè¯</button>
    </div>
  </div>

  <!-- This is needed as it is a key to using icons from fontawesome.com -->
  <script src="./6478f529f2.js" crossorigin="anonymous"></script>
  <script>
    const messages = [
      {
        author: 'Sophia',
        avatar: 'Photos/leo.JPG',
        content: [
          { type: 'text', text: 'Do you have more toilet papers? It\'s super fun!', time: '15:20' },
          { type: 'image', src: './1.png' },
          { type: 'image', src: './1.png' },
          { type: 'text', text: 'If you are wondering, I miss you a lot right now.', time: '12:55' },
          { type: 'text', text: 'Do you have more toilet papers? It\'s super fun!', time: '15:20' },
          { type: 'text', text: 'ğŸ§» ğŸ§» ğŸ§»', time: '15:21' }
        ]
      },
      {
        author: 'Sophia',
        avatar: 'Photos/leo.JPG',
        content: [
          { type: 'text', text: 'Done playing! ğŸ¶', time: '15:35' },
        ]
      },
    ];

    const chatContainer = document.getElementById('chat-container');

    function renderMessage(message) {
      setTimeout(() => {
        const messageRow = document.createElement('div');
        messageRow.classList.add('message-row');
        if (message.author === 'own') {
          messageRow.classList.add('message-row--own');
        } else {
          const avatar = document.createElement('img');
          avatar.src = message.avatar;
          avatar.classList.add('avatar');
          messageRow.appendChild(avatar);
        }

        const messageContent = document.createElement('div');
        messageContent.classList.add('message-row__content');

        message.content.forEach(content => {
          const messageInfo = document.createElement('div');
          messageInfo.classList.add('message__info');

          if (content.type === 'image') {
            const img = document.createElement('img');
            img.src = content.src;
            img.classList.add('chat-image');
            messageInfo.appendChild(img);
          } else if (content.type === 'text') {
            const messageBubble = document.createElement('span');
            messageBubble.classList.add('message__bubble');
            messageBubble.textContent = content.text;
            messageInfo.appendChild(messageBubble);

            if (content.time) {
              const messageTime = document.createElement('span');
              messageTime.classList.add('message__time');
              messageTime.textContent = content.time;
              messageInfo.appendChild(messageTime);
            }
          }

          messageContent.appendChild(messageInfo);
        });

        messageRow.appendChild(messageContent);
        chatContainer.appendChild(messageRow);

        // Scroll to the latest message
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }, 0);
    }

    messages.forEach(renderMessage);

    const replyForm = document.querySelector('.reply');
    replyForm.addEventListener('submit', function(event) {
      event.preventDefault();
      const input = replyForm.querySelector('input[type="text"]');
      const newMessage = input.value.trim();
      if (newMessage) {
        const message = {
          author: 'own',
          content: [{ type: 'text', text: newMessage, time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) }]
        };
        messages.push(message);
        renderMessage(message);
        input.value = '';
      }
    });

    // æ·»åŠ æ˜¾ç¤ºæ¨¡æ€å¼¹çª—çš„å‡½æ•°
    function showModal(callback) {
      const modalOverlay = document.getElementById('modal-overlay');
      modalOverlay.style.display = 'flex';

      const verifyButton = document.getElementById('verify-button');
      verifyButton.onclick = function() {
        modalOverlay.style.display = 'none';
        callback();
      };
    }
    var firstClickDone = false;
    // æ›´æ–°å›¾ç‰‡çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
    document.addEventListener('click', function(event) {
      if (event.target.classList.contains('chat-image')) {
        const imgElement = event.target;

        if (!firstClickDone) {
          // ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œç›´æ¥æ˜¾ç¤ºå›¾ç‰‡
          imgElement.style.filter = 'none'; // å»é™¤æ¨¡ç³Šæ•ˆæœ
          imgElement.dataset.firstClickDone = 'true'; // æ ‡è®°å·²å®Œæˆç¬¬ä¸€æ¬¡ç‚¹å‡»
          firstClickDone = true;
        } else {
          // å·²ç»ç‚¹å‡»è¿‡ï¼Œæ˜¾ç¤ºæ¨¡æ€å¼¹çª—
          imgElement.style.filter = 'blur(5px)'; // é‡æ–°åº”ç”¨æ¨¡ç³Šæ•ˆæœ
          showModal(function() {
            setTimeout(function() {
              imgElement.style.filter = 'none'; // 3 ç§’åå»é™¤æ¨¡ç³Šæ•ˆæœ
            }, 3000);
          });
        }
      }
    });
  </script>
</body>

</html>